\nimport React, { useState } from \'react\';\nimport { Network, Layers, Share2, Loader, Map, AlertTriangle } from \'lucide-react\';\nimport { Atlas } from \'../services/atlasService\';\nimport ReactMarkdown from \'react-markdown\';\nimport MermaidBlock from \'../components/MermaidBlock\';\nimport { motion, AnimatePresence } from \'framer-motion\';\n\nconst MotionDiv = motion.div as any;\n\ninterface ArchitectResult {\n    diagram: string;\n    explanation: string;\n}\n\n// --- SOPHISTICATED LOADING STATE ---\nconst BlueprintSkeleton: React.FC = () => (\n    <div className=\"w-full h-full p-8 space-y-8 animate-pulse\">\n        <div className=\"bg-slate-800/50 rounded-lg h-1/2 w-full p-4\">\n            <div className=\"h-4 w-1/4 bg-slate-700/50 rounded mb-4\"></div>\n            <div className=\"h-full w-full bg-slate-700/50 rounded\"></div>\n        </div>\n        <div className=\"space-y-4\">\n            <div className=\"h-6 w-1/3 bg-slate-700/50 rounded\"></div>\n            <div className=\"h-4 w-full bg-slate-700/50 rounded\"></div>\n            <div className=\"h-4 w-full bg-slate-700/50 rounded\"></div>\n            <div className=\"h-4 w-3/4 bg-slate-700/50 rounded\"></div>\n        </div>\n    </div>\n);\n\nconst Architect: React.FC = () => {\n  const [requirements, setRequirements] = useState(\'\');\n  const [result, setResult] = useState<ArchitectResult | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const handleDesign = async () => {\n    if (!requirements.trim()) return;\n    setLoading(true);\n    setResult(null);\n    setError(null);\n\n    // --- ADVANCED PROMPT ENGINEERING ---\n    const prompt = `\n        You are The Architect, an expert system designer AI. \n        Your task is to analyze user requirements and produce a comprehensive system architecture blueprint.\n\n        The user\'s request is: \"${requirements}\"\n\n        You MUST return your response as a single, raw JSON object with no other text or explanation. \n        The JSON object must have the following two keys:\n        1. \"diagram\": A string containing a Mermaid.js graph definition (using \`graph TD;\`). This diagram should visually represent the core components and data flow of the system.\n        2. \"explanation\": A detailed markdown string explaining the architecture. It should cover:\n            - Core Components: A breakdown of each part of the diagram (e.g., Load Balancer, API Gateway, Microservices, Database).\n            - Data Flow: How data moves through the system.\n            - Technology Stack Recommendations: Suggest appropriate technologies for each component.\n            - Scalability & Resilience: Briefly discuss how the system can scale and handle failures.\n\n        Example Mermaid syntax for a node: \`WebApp[Web Application]\`\n        Ensure the entire output is a single, valid JSON object.\n    `;\n\n    try {\n        const response = await Atlas.generate(prompt, { isJson: true }) as { warning: string, data: ArchitectResult };\n        if (!response.data || !response.data.diagram || !response.data.explanation) {\n            throw new Error(\"AI response was incomplete or in the wrong format.\");\n        }\n        setResult(response.data);\n    } catch (e: any) {\n        console.error(e);\n        setError(e.message || \"An unknown error occurred during blueprint generation.\");\n    } finally {\n        setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"h-full flex flex-col bg-slate-950 p-4 md:p-8 font-sans text-slate-300\">\n       <header className=\"max-w-7xl mx-auto mb-8 w-full flex items-center justify-between border-b border-slate-800 pb-6\">\n            <div className=\"flex items-center gap-4\">\n                <div className=\"p-3 bg-indigo-900/20 rounded-xl border border-indigo-500/30\">\n                    <Network className=\"w-8 h-8 text-indigo-500\" />\n                </div>\n                <div>\n                    <h1 className=\"text-3xl font-black text-white tracking-tight uppercase\">The Architect</h1>\n                    <p className=\"text-slate-500 font-mono text-sm\">System Design & Visual Blueprint Engine</p>\n                </div>\n            </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto w-full grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1\">\n        <div className=\"lg:col-span-4 flex flex-col space-y-4 h-full\">\n            <div className=\"bg-slate-900 rounded-xl border border-slate-800 p-6 flex-1 flex flex-col\">\n                <label className=\"text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 flex items-center gap-2\">\n                    <Layers className=\"w-4 h-4\" /> System Requirements\n                </label>\n                <textarea\n                    value={requirements}\n                    onChange={(e) => setRequirements(e.target.value)}\n                    placeholder=\"Describe the system... e.g. \'A real-time ride sharing app backend with matchmaking, geo-hashing, and payment processing.\'\"\n                    className=\"flex-1 w-full bg-slate-950/50 p-4 font-mono text-sm focus:outline-none resize-none custom-scrollbar text-slate-300 placeholder-slate-700 rounded-lg border border-slate-800 focus:border-indigo-500/50 transition-colors\"\n                    disabled={loading}\n                />\n            </div>\n            <button\n                onClick={handleDesign}\n                disabled={loading || !requirements.trim()}\n                className=\"w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-bold uppercase tracking-widest rounded-xl transition-all disabled:opacity-50 flex items-center justify-center gap-2 shadow-lg shadow-indigo-900/20 disabled:shadow-none\"\n            >\n                {loading ? <Loader className=\"w-5 h-5 animate-spin\" /> : <Map className=\"w-5 h-5\" />}\n                {loading ? \'Architecting...\' : \'Generate Blueprint\'}\n            </button>\n        </div>\n\n        <div className=\"lg:col-span-8 flex flex-col h-full bg-slate-900 border border-slate-800 rounded-xl overflow-hidden relative shadow-inner\">\n            <div className=\"absolute inset-0 opacity-[0.03] pointer-events-none\" style={{ backgroundImage: `linear-gradient(#6366f1 1px, transparent 1px), linear-gradient(90deg, #6366f1 1px, transparent 1px)`, backgroundSize: \'40px 40px\' }}></div>\n            \n            <div className=\"flex-1 overflow-y-auto custom-scrollbar relative\">\n                <AnimatePresence mode=\"wait\">\n                    {loading && (\n                        <MotionDiv key=\"skeleton\" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}}><BlueprintSkeleton /></MotionDiv>\n                    )}\n                    {!loading && error && (\n                         <MotionDiv key=\"error\" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} className=\"h-full flex flex-col items-center justify-center p-8 text-center\">\n                            <AlertTriangle className=\"w-16 h-16 mb-6 text-red-500/50\" />\n                            <h3 className=\"text-lg font-bold text-red-400 mb-2\">Generation Failed</h3>\n                            <p className=\"font-mono text-sm text-slate-500 bg-slate-800/50 p-4 rounded-md\">{error}</p>\n                        </MotionDiv>\n                    )}\n                    {!loading && !result && !error && (\n                        <MotionDiv key=\"initial\" initial={{opacity:0}} animate={{opacity:1}} exit={{opacity:0}} className=\"h-full flex flex-col items-center justify-center text-slate-700 p-8\">\n                            <Share2 className=\"w-16 h-16 mb-6 opacity-20\" />\n                            <p className=\"font-mono text-sm text-slate-600 uppercase tracking-widest text-center\">Awaiting System Specifications to Generate Blueprint</p>\n                        </MotionDiv>\n                    )}\n                    {!loading && result && (\n                         <MotionDiv key=\"result\" initial={{opacity:0}} animate={{opacity:1}} className=\"space-y-8 relative z-10 p-4 md:p-8\">\n                            {result.diagram && (\n                                <div className=\"bg-slate-950/50 rounded-lg p-2 border border-slate-800 shadow-inner\">\n                                    <div className=\"text-[10px] font-mono text-indigo-400 uppercase tracking-widest mb-2 px-2\">Visual Topology</div>\n                                    <MermaidBlock chart={result.diagram} />\n                                </div>\n                            )}\n                            <div className=\"prose prose-sm md:prose-base prose-invert max-w-none prose-headings:font-bold prose-headings:text-indigo-200 prose-code:text-indigo-300 prose-a:text-indigo-400 prose-strong:text-slate-100\">\n                                <ReactMarkdown>{result.explanation}</ReactMarkdown>\n                            </div>\n                         </MotionDiv>\n                    )}\n                </AnimatePresence>\n            </div>\n        </div>\n      </main>\n    </div>\n  );\n};\n\nexport default Architect;\n